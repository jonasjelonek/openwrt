/dts-v1/;

#include "rtl839x.dtsi"

#include <dt-bindings/input/input.h>
#include <dt-bindings/gpio/gpio.h>

/ {
        compatible = "zyxel,gs1920-24hp", "realtek,rtl8392-soc";
        model = "Zyxel GS1920-24HP";

        aliases {
                led-boot = &led_sys;
                led-failsafe = &led_sys;
                led-running = &led_sys;
                led-upgrade = &led_sys;
        };

        memory@0 {
                device_type = "memory";
                reg = <0x0 0x8000000>;
        };
/*
        chosen {
                stdout-path = "serial0:9600n8";
        };
*/

        leds {
                pinctrl-names = "default";
                pinctrl-0 = <&pinmux_disable_sys_led>;
                compatible = "gpio-leds";

                led_sys: sys {
                        label = "green:sys";
                        gpios = <&gpio0 0 GPIO_ACTIVE_HIGH>;
                };

                alarm {
                        label = "red:alarm";
                        gpios = <&gpio1 8 GPIO_ACTIVE_LOW>;
                };

                locator {
                        label = "blue:locator";
                        gpios = <&gpio1 14 GPIO_ACTIVE_LOW>;
                };
        };

        keys {
                compatible = "gpio-keys-polled";
                poll-interval = <20>;

                mode {
                        label = "reset";
                        gpios = <&gpio1 32 GPIO_ACTIVE_LOW>;
                        linux,code = <KEY_RESTART>;
                };
        };

        /* i2c of the lower left SFP cage: port 25 */
        i2c0: i2c-gpio-0 {
                compatible = "i2c-gpio";
                sda-gpios = <&gpio1 4 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                scl-gpios = <&gpio1 3 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                i2c-gpio,delay-us = <2>;
                #address-cells = <1>;
                #size-cells = <0>;
        };

        sfp0: sfp-p25 {
                compatible = "sff,sfp";
                i2c-bus = <&i2c0>;
                los-gpio = <&gpio1 1 GPIO_ACTIVE_HIGH>;
                mod-def0-gpio = <&gpio0 23 GPIO_ACTIVE_LOW>;
                tx-fault-gpio = <&gpio1 0 GPIO_ACTIVE_HIGH>;
        };

        /* i2c of the upper left SFP cage: port 26 */
        i2c1: i2c-gpio-1 {
                compatible = "i2c-gpio";
                sda-gpios = <&gpio1 10 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                scl-gpios = <&gpio1 9 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                i2c-gpio,delay-us = <2>;
                #address-cells = <1>;
                #size-cells = <0>;
        };

        sfp1: sfp-p26 {
                compatible = "sff,sfp";
                i2c-bus = <&i2c1>;
                los-gpio = <&gpio1 7 GPIO_ACTIVE_HIGH>;
                mod-def0-gpio = <&gpio0 17 GPIO_ACTIVE_LOW>;
                tx-fault-gpio = <&gpio1 6 GPIO_ACTIVE_HIGH>;
        };

        /* i2c of the lower right SFP cage: port 27 */
        i2c2: i2c-gpio-2 {
                compatible = "i2c-gpio";
                sda-gpios = <&gpio1 11 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                scl-gpios = <&gpio1 15 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                i2c-gpio,delay-us = <2>;
                #address-cells = <1>;
                #size-cells = <0>;
        };

        sfp2: sfp-p27 {
                compatible = "sff,sfp";
                i2c-bus = <&i2c2>;
                los-gpio = <&gpio1 13 GPIO_ACTIVE_HIGH>;
                mod-def0-gpio = <&gpio0 13 GPIO_ACTIVE_LOW>;
                tx-fault-gpio = <&gpio1 12 GPIO_ACTIVE_HIGH>;
        };

        /* i2c of the upper right SFP cage: port 28 */
        i2c3: i2c-gpio-3 {
                compatible = "i2c-gpio";
                sda-gpios = <&gpio1 22 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                scl-gpios = <&gpio1 21 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
                i2c-gpio,delay-us = <2>;
                #address-cells = <1>;
                #size-cells = <0>;
        };

        sfp3: sfp-p28 {
                compatible = "sff,sfp";
                i2c-bus = <&i2c3>;
                los-gpio = <&gpio1 29 GPIO_ACTIVE_HIGH>;
                mod-def0-gpio = <&gpio0 20 GPIO_ACTIVE_LOW>;
                tx-fault-gpio = <&gpio1 23 GPIO_ACTIVE_HIGH>;
        };
};

&spi0 {
        status = "okay";
        flash@0 {
                compatible = "jedec,spi-nor";
                reg = <0>;
                spi-max-frequency = <10000000>;

                partitions {
                        compatible = "fixed-partitions";
                        #address-cells = <1>;
                        #size-cells = <1>;

                        partition@0 {
                                label = "bootbase";
                                reg = <0x0 0x20000>;
                                read-only;
                        };
                        partition@20000 {
                                label = "dbgarea";
                                reg = <0x20000 0x10000>;
                                read-only;
                        };
                        partition@30000 {
                                label = "romdir2";
                                reg = <0x30000 0x80000>;
                                read-only;
                        };
                        partition@b0000 {
                                reg = <0xb0000 0x710000>;
                                label = "factory";

                                compatible = "fixed-partitions";
                                #address-cells = <1>;
                                #size-cells = <1>;

                                partition@0 {
                                        label = "loader";
                                        reg = <0x0 0x10000>;
                                };

                                partition@10000 {
                                        label = "firmware";
                                        reg = <0x10000 0x700000>;
                                        compatible = "openwrt,uimage", "denx,uimage";
                                };
                        };
                        partition@7c0000 {
                                label = "logarea1";
                                reg = <0x7c0000 0x20000>;
                                read-only;
                        };
                        partition@7e0000 {
                                label = "logarea2";
                                reg = <0x7e0000 0x20000>;
                                read-only;
                        };
                        partition@830000 {
                                label = "romdir2a";
                                reg = <0x830000 0x80000>;
                        };
                        partition@8b0000 {
                                label = "firmware2";
                                reg = <0x8b0000 0x710000>;
                        };
                };
        };
};

&ethernet0 {
        mdio: mdio-bus {
                compatible = "realtek,rtl838x-mdio";
                regmap = <&ethernet0>;
                #address-cells = <1>;
                #size-cells = <0>;

                /* External phy RTL8218B #1 */
                EXTERNAL_PHY(0)
                EXTERNAL_PHY(1)
                EXTERNAL_PHY(2)
                EXTERNAL_PHY(3)
                EXTERNAL_PHY(4)
                EXTERNAL_PHY(5)
                EXTERNAL_PHY(6)
                EXTERNAL_PHY(7)

                /* External phy RTL8218B #2 */
                EXTERNAL_PHY(8)
                EXTERNAL_PHY(9)
                EXTERNAL_PHY(10)
                EXTERNAL_PHY(11)
                EXTERNAL_PHY(12)
                EXTERNAL_PHY(13)
                EXTERNAL_PHY(14)
                EXTERNAL_PHY(15)

                /* External phy RTL8218B #3 */
                EXTERNAL_PHY(16)
                EXTERNAL_PHY(17)
                EXTERNAL_PHY(18)
                EXTERNAL_PHY(19)
                EXTERNAL_PHY(20)
                EXTERNAL_PHY(21)
                EXTERNAL_PHY(22)
                EXTERNAL_PHY(23)

                /* External phy RTL8214FC #1 */
                EXTERNAL_SFP_PHY_FULL(48, 0)
                EXTERNAL_SFP_PHY_FULL(49, 1)
                EXTERNAL_SFP_PHY_FULL(50, 2)
                EXTERNAL_SFP_PHY_FULL(51, 3)

        };
};

&switch0 {
        ports {
                #address-cells = <1>;
                #size-cells = <0>;

                SWITCH_PORT(0, 1, qsgmii)
                SWITCH_PORT(1, 2, qsgmii)
                SWITCH_PORT(2, 3, qsgmii)
                SWITCH_PORT(3, 4, qsgmii)
                SWITCH_PORT(4, 5, qsgmii)
                SWITCH_PORT(5, 6, qsgmii)
                SWITCH_PORT(6, 7, qsgmii)
                SWITCH_PORT(7, 8, qsgmii)

                SWITCH_PORT(8, 9, qsgmii)
                SWITCH_PORT(9, 10, qsgmii)
                SWITCH_PORT(10, 11, qsgmii)
                SWITCH_PORT(11, 12, qsgmii)
                SWITCH_PORT(12, 13, qsgmii)
                SWITCH_PORT(13, 14, qsgmii)
                SWITCH_PORT(14, 15, qsgmii)
                SWITCH_PORT(15, 16, qsgmii)

                SWITCH_PORT(16, 17, qsgmii)
                SWITCH_PORT(17, 18, qsgmii)
                SWITCH_PORT(18, 19, qsgmii)
                SWITCH_PORT(19, 20, qsgmii)
                SWITCH_PORT(20, 21, qsgmii)
                SWITCH_PORT(21, 22, qsgmii)
                SWITCH_PORT(22, 23, qsgmii)
                SWITCH_PORT(23, 24, qsgmii)

                SWITCH_PORT(48, 25, qsgmii)
                SWITCH_PORT(49, 26, qsgmii)
                SWITCH_PORT(50, 27, qsgmii)
                SWITCH_PORT(51, 28, qsgmii)

                /* CPU-Port */
                port@52 {
                        ethernet = <&ethernet0>;
                        reg = <52>;
                        phy-mode = "qsgmii";
                        fixed-link {
                                speed = <1000>;
                                full-duplex;
                        };
                };
        };
};

&mdio_aux {
        status = "okay";

        gpio1: expander@3 {
                compatible = "realtek,rtl8231";
                reg = <3>;

                gpio-controller;
                #gpio-cells = <2>;
                gpio-ranges = <&gpio1 0 0 37>;

                led-controller {
                        compatible = "realtek,rtl8231-leds";
                        status = "disabled";
                };
        };
};
