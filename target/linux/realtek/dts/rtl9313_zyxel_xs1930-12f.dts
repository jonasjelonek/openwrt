// SPDX-License-Identifier: GPL-2.0-or-later
/dts-v1/;

#include "rtl9313_zyxel_xs1930.dtsi"

#include <dt-bindings/input/input.h>
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/mux/mux.h>

/ {
	compatible = "zyxel,xs1930-12f", "realtek,rtl9313-soc";
	model = "Zyxel XS1930-12F";

	/*
	aliases {
		led-boot = &led_sys;
		led-failsafe = &led_sys;
		led-running = &led_sys;
		led-upgrade = &led_sys;
	};
	*/

	leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinmux_enable_sys_led>;

		led_pwr_green: led-0 {
			reg = <0>;
			color = <LED_COLOR_ID_GREEN>;
			default-state = "on";
			gpios = <&gpio2 10 GPIO_ACTIVE_HIGH>;
			label = "pwr:green";
		};
		led_pwr_red: led-1 {
			reg = <1>;
			color = <LED_COLOR_ID_RED>;
			gpios = <&gpio2 11 GPIO_ACTIVE_LOW>;
			label = "pwr:red";
		};
		/*led_sys_red: led-2 {
			reg = <2>;
			color = <LED_COLOR_ID_RED>;
			gpios = <&gpio0 30 GPIO_ACTIVE_LOW>;
			label = "sys:red";
		};
		led_sys_green: led-3 {
			reg = <3>;
			color = <LED_COLOR_ID_GREEN>;
			default-state = "on";
			function = LED_FUNCTION_ACTIVITY;
			gpios = <&gpio0 0 GPIO_ACTIVE_LOW>;
			label = "sys:green";
		};*/
		led_cloud_green: led-4 {
			reg = <4>;
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&gpio1 17 GPIO_ACTIVE_LOW>;
			label = "cloud:green";
		};
		led_cloud_red: led-5 {
			reg = <5>;
			color = <LED_COLOR_ID_RED>;
			gpios = <&gpio1 16 GPIO_ACTIVE_LOW>;
			label = "cloud:red";
		};
		led_locator: led-6 {
			reg = <6>;
			color = <LED_COLOR_ID_BLUE>;
			function = LED_FUNCTION_INDICATOR;
			gpios = <&gpio1 15 GPIO_ACTIVE_LOW>;
			label = "locator";
		};
	};

	led_set: led_set@0 {
		compatible = "realtek,rtl9300-leds";
		active-low;

		/* SFP ports */
		led_set0 = <(RTL93XX_LED_SET_10G | RTL93XX_LED_SET_LINK | RTL93XX_LED_SET_ACT)
			    (RTL93XX_LED_SET_1G | RTL93XX_LED_SET_LINK | RTL93XX_LED_SET_ACT)>;
		/* Base-T ports */
		led_set1 = <(RTL93XX_LED_SET_10G | RTL93XX_LED_SET_5G | RTL93XX_LED_SET_2P5G | RTL93XX_LED_SET_LINK | RTL93XX_LED_SET_ACT)
			    (RTL93XX_LED_SET_2P5G | RTL93XX_LED_SET_1G | RTL93XX_LED_SET_100M | RTL93XX_LED_SET_LINK | RTL93XX_LED_SET_ACT)
			    (RTL93XX_LED_SET_5G | RTL93XX_LED_SET_100M | RTL93XX_LED_SET_LINK | RTL93XX_LED_SET_ACT)>;
	};

	sfp1: sfp-p1 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c0>;
		los-gpio = <&gpio1 10 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 3 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 0 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 36 GPIO_ACTIVE_HIGH>;
	};

	sfp2: sfp-p2 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c1>;
		los-gpio = <&gpio1 11 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 4 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 1 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 21 GPIO_ACTIVE_HIGH>;
	};

	sfp3: sfp-p3 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c2>;
		los-gpio = <&gpio1 12 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 25 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 2 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 22 GPIO_ACTIVE_HIGH>;
	};

	sfp4: sfp-p4 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c3>;
		los-gpio = <&gpio1 13 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 6 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 3 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 23 GPIO_ACTIVE_HIGH>;
	};

	sfp5: sfp-p5 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c4>;
		los-gpio = <&gpio1 14 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 7 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 4 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 24 GPIO_ACTIVE_HIGH>;
	};

	sfp6: sfp-p6 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c5>;
		los-gpio = <&gpio1 34 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 29 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 5 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 25 GPIO_ACTIVE_HIGH>;
	};

	sfp7: sfp-p7 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c6>;
		los-gpio = <&gpio1 33 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 31 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 6 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 26 GPIO_ACTIVE_HIGH>;
	};

	sfp8: sfp-p8 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c7>;
		los-gpio = <&gpio1 32 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 10 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 7 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 27 GPIO_ACTIVE_HIGH>;
	};

	sfp9: sfp-p9 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c8>;
		los-gpio = <&gpio1 31 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 11 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 8 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 28 GPIO_ACTIVE_HIGH>;
	};

	sfp10: sfp-p10 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c9>;
		los-gpio = <&gpio1 30 GPIO_ACTIVE_HIGH>;
		mod-def0-gpio = <&gpio0 12 GPIO_ACTIVE_LOW>;
		tx-disable-gpio = <&gpio1 9 GPIO_ACTIVE_HIGH>;
		tx-fault-gpio = <&gpio1 29 GPIO_ACTIVE_HIGH>;
	};
};

&gpio0 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinmux_disable_jtag>,
		    <&pinmux_disable_led_sync>;
};

&i2c_mst1 {
	status = "okay";

	i2c0: i2c@0 {
		reg = <0>;
	};
	i2c1: i2c@1 {
		reg = <1>;
	};
	i2c2: i2c@2 {
		reg = <2>;
	};
	i2c3: i2c@3 {
		reg = <3>;
	};
	i2c4: i2c@4 {
		reg = <4>;
	};
	i2c5: i2c@5 {
		reg = <5>;
	};
};

&i2c_mst2 {
	status = "okay";

	i2c6: i2c@6 {
		reg = <6>;
	};
	i2c7: i2c@7 {
		reg = <7>;
	};
	i2c8: i2c@8 {
		reg = <8>;
	};
	i2c9: i2c@9 {
		reg = <9>;
	};

	i2c11: i2c@b {
		reg = <0xb>;

		gpio2: pca9555@20 {
			compatible = "nxp,pca9555";
			reg = <0x20>;
			gpio-controller;
			#gpio-cells = <2>;

			/* These GPIOs must be held low to activate SFP slots.
			 * Otherwise, neither power, signals nor I2C work.
			 */
			sfp_enable_hog {
				gpio-hog;
				gpios = <0 GPIO_ACTIVE_LOW>, /* SFP1 */
					<1 GPIO_ACTIVE_LOW>, /* SFP2 */
					<2 GPIO_ACTIVE_LOW>, /* SFP3 */
					<3 GPIO_ACTIVE_LOW>, /* SFP4 */
					<4 GPIO_ACTIVE_LOW>, /* SFP5 */
					<5 GPIO_ACTIVE_LOW>, /* SFP6 */
					<6 GPIO_ACTIVE_LOW>, /* SFP7 */
					<7 GPIO_ACTIVE_LOW>, /* SFP8 */
					<8 GPIO_ACTIVE_LOW>, /* SFP9 */
					<9 GPIO_ACTIVE_LOW>; /* SFP10 */
				output-high;
				line-name = "enable-sfp-slots";
			};
		};

		lm96000: lm96000@2e {
			compatible = "national,lm85";
			reg = <0x2e>;
		};
	};
};

&mdio_aux {
	status = "okay";

	gpio1: gpio@1f {
		compatible = "realtek,rtl8231";
		reg = <0x1f>;

		gpio-controller;
		#gpio-cells = <2>;
		gpio-ranges = <&gpio1 0 0 37>;

		led-controller {
			compatible = "realtek,rtl8231-leds";
			status = "disabled";
		};
	};
};

&mdio_ctrl {
	pinctrl-names = "default";
	pinctrl-0 = <&pinmux_enable_mdc_mdio_1>,
		    <&pinmux_enable_mdc_mdio_2>;
};

&mdio_bus1 {
	/* AQR113C */
	phy54: ethernet-phy@54 {
		reg = <54>;
		compatible = "ethernet-phy-ieee802.3-c45";
		realtek,smi-address = <0>;
	};
};

&mdio_bus2 {
	/* AQR113C */
	phy55: ethernet-phy@55 {
		reg = <55>;
		compatible = "ethernet-phy-ieee802.3-c45";
		realtek,smi-address = <8>;
	};
};

&switch0 {
	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port0: port@0 {
			reg = <0>;
			label = SWITCH_PORT_LABEL(1);
			led-set = <0>;
			pcs-handle = <&serdes2>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp1>;
		};
		port8: port@8 {
			reg = <8>;
			label = SWITCH_PORT_LABEL(2);
			led-set = <0>;
			pcs-handle = <&serdes3>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp2>;
		};
		port16: port@16 {
			reg = <16>;
			label = SWITCH_PORT_LABEL(3);
			led-set = <0>;
			pcs-handle = <&serdes4>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp3>;
		};
		port24: port@24 {
			reg = <24>;
			label = SWITCH_PORT_LABEL(4);
			led-set = <0>;
			pcs-handle = <&serdes5>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp4>;
		};
		port32: port@32 {
			reg = <32>;
			label = SWITCH_PORT_LABEL(5);
			led-set = <0>;
			pcs-handle = <&serdes6>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp5>;
		};
		port40: port@40 {
			reg = <40>;
			label = SWITCH_PORT_LABEL(6);
			led-set = <0>;
			pcs-handle = <&serdes7>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp6>;
		};
		port48: port@48 {
			reg = <48>;
			label = SWITCH_PORT_LABEL(7);
			led-set = <0>;
			pcs-handle = <&serdes8>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp7>;
		};
		port50: port@50 {
			reg = <50>;
			label = SWITCH_PORT_LABEL(8);
			led-set = <0>;
			pcs-handle = <&serdes9>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp8>;
		};
		port52: port@52 {
			reg = <52>;
			label = SWITCH_PORT_LABEL(9);
			led-set = <0>;
			pcs-handle = <&serdes10>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp9>;
		};
		port53: port@53 {
			reg = <53>;
			label = SWITCH_PORT_LABEL(10);
			led-set = <0>;
			pcs-handle = <&serdes11>;
			phy-mode = "1000base-x";
			managed = "in-band-status";
			sfp = <&sfp10>;
		};

		/* Base-T ports */
		port@54 {
			reg = <54>;
			label = SWITCH_PORT_LABEL(11);
			led-set = <1>;
			pcs-handle = <&serdes12>;
			phy-handle = <&phy54>;
			phy-mode = "usxgmii";
		};
		port@55 {
			reg = <55>;
			label = SWITCH_PORT_LABEL(12);
			led-set = <1>;
			pcs-handle = <&serdes13>;
			phy-handle = <&phy55>;
			phy-mode = "usxgmii";
		};

		/* CPU port */
		port@56 {
			ethernet = <&ethernet0>;
			reg = <56>;
			phy-mode = "internal";
			fixed-link {
				speed = <1000>;
				full-duplex;
			};
		};
	};
};


&serdes2 {
	realtek,pnswap-tx;
};

&serdes3 {
	realtek,pnswap-tx;
};

&serdes4 {
	realtek,pnswap-tx;
};

&serdes5 {
	realtek,pnswap-tx;
};

&serdes6 {
	realtek,pnswap-tx;
};

&serdes7 {
	realtek,pnswap-tx;
};

&serdes8 {
	realtek,pnswap-tx;
};

&serdes9 {
	realtek,pnswap-tx;
};

&serdes10 {
	realtek,pnswap-tx;
};

&serdes11 {
	realtek,pnswap-tx;
};

